{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "properties": {
    "opentelemetry-collector": {
      "title": "The opentelemetry-collector Schema",
      "type": "object",
      "default": {},
      "required": [
        "mode",
        "image"
      ],
      "properties": {
        "mode": {
          "title": "The mode Schema",
          "type": "string",
          "default": "deployment",
          "render": "textArea"
        },
        "image": {
          "title": "The image Schema",
          "type": "object",
          "default": {},
          "required": [
            "repository"
          ],
          "properties": {
            "repository": {
              "title": "The repository Schema",
              "type": "string",
              "default": "otel/opentelemetry-collector-contrib",
              "render": "textArea"
            }
          }
        },
        "config": {
          "title": "The config Schema",
          "type": "object",
          "default": {},
          "required": [
            "exporters",
            "extensions",
            "processors",
            "receivers",
            "service"
          ],
          "properties": {
            "exporters": {
              "title": "The exporters Schema",
              "type": "object",
              "default": {},
              "render": "textArea",
              "required": [
                "debug"
              ],
              "properties": {
                "debug": {
                  "title": "The debug Schema",
                  "type": "object",
                  "default": {},
                  "required": [],
                  "properties": {}
                }
              }
            },
            "extensions": {
              "title": "The extensions Schema",
              "type": "object",
              "default": {},
              "required": [
                "health_check",
                "memory_ballast"
              ],
              "properties": {
                "health_check": {
                  "title": "The health_check Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "endpoint"
                  ],
                  "properties": {
                    "endpoint": {
                      "title": "The endpoint Schema",
                      "type": "string",
                      "default": "${env:MY_POD_IP}:13133"
                    }
                  }
                },
                "memory_ballast": {
                  "title": "The memory_ballast Schema",
                  "type": "object",
                  "default": {},
                  "required": [],
                  "properties": {}
                }
              }
            },
            "processors": {
              "title": "The processors Schema",
              "type": "object",
              "default": {},
              "required": [
                "batch",
                "memory_limiter"
              ],
              "properties": {
                "batch": {
                  "title": "The batch Schema",
                  "type": "object",
                  "default": {},
                  "required": [],
                  "properties": {}
                },
                "memory_limiter": {
                  "title": "The memory_limiter Schema",
                  "type": "null",
                  "default": "null",
                  "examples": [
                    null
                  ]
                }
              }
            },
            "receivers": {
              "title": "The receivers Schema",
              "type": "object",
              "default": {},
              "required": [
                "jaeger",
                "otlp",
                "prometheus",
                "zipkin"
              ],
              "properties": {
                "jaeger": {
                  "title": "The jaeger Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "protocols"
                  ],
                  "properties": {
                    "protocols": {
                      "title": "The protocols Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "grpc",
                        "thrift_http",
                        "thrift_compact"
                      ],
                      "properties": {
                        "grpc": {
                          "title": "The grpc Schema",
                          "type": "object",
                          "default": {},
                          "required": [
                            "endpoint"
                          ],
                          "properties": {
                            "endpoint": {
                              "title": "The endpoint Schema",
                              "type": "string",
                              "default": "${env:MY_POD_IP}:14250"
                            }
                          }
                        },
                        "thrift_http": {
                          "title": "The thrift_http Schema",
                          "type": "object",
                          "default": {},
                          "required": [
                            "endpoint"
                          ],
                          "properties": {
                            "endpoint": {
                              "title": "The endpoint Schema",
                              "type": "string",
                              "default": "${env:MY_POD_IP}:14268"
                            }
                          }
                        },
                        "thrift_compact": {
                          "title": "The thrift_compact Schema",
                          "type": "object",
                          "default": {},
                          "required": [
                            "endpoint"
                          ],
                          "properties": {
                            "endpoint": {
                              "title": "The endpoint Schema",
                              "type": "string",
                              "default": "${env:MY_POD_IP}:6831"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "otlp": {
                  "title": "The otlp Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "protocols"
                  ],
                  "properties": {
                    "protocols": {
                      "title": "The protocols Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "grpc",
                        "http"
                      ],
                      "properties": {
                        "grpc": {
                          "title": "The grpc Schema",
                          "type": "object",
                          "default": {},
                          "required": [
                            "endpoint"
                          ],
                          "properties": {
                            "endpoint": {
                              "title": "The endpoint Schema",
                              "type": "string",
                              "default": "${env:MY_POD_IP}:4317"
                            }
                          }
                        },
                        "http": {
                          "title": "The http Schema",
                          "type": "object",
                          "default": {},
                          "required": [
                            "endpoint"
                          ],
                          "properties": {
                            "endpoint": {
                              "title": "The endpoint Schema",
                              "type": "string",
                              "default": "${env:MY_POD_IP}:4318"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "prometheus": {
                  "title": "The prometheus Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "config"
                  ],
                  "properties": {
                    "config": {
                      "title": "The config Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "scrape_configs"
                      ],
                      "properties": {
                        "scrape_configs": {
                          "title": "The scrape_configs Schema",
                          "type": "array",
                          "default": [],
                          "items": {
                            "title": "A Schema",
                            "type": "object",
                            "default": {},
                            "required": [
                              "job_name",
                              "scrape_interval",
                              "static_configs"
                            ],
                            "properties": {
                              "job_name": {
                                "title": "The job_name Schema",
                                "type": "string",
                                "default": "opentelemetry-collector"
                              },
                              "scrape_interval": {
                                "title": "The scrape_interval Schema",
                                "type": "string",
                                "default": "10s"
                              },
                              "static_configs": {
                                "title": "The static_configs Schema",
                                "type": "array",
                                "default": [],
                                "items": {
                                  "title": "A Schema",
                                  "type": "object",
                                  "default": {},
                                  "required": [
                                    "targets"
                                  ],
                                  "properties": {
                                    "targets": {
                                      "title": "The targets Schema",
                                      "type": "array",
                                      "default": [],
                                      "items": {
                                        "title": "A Schema",
                                        "type": "string",
                                        "default": "${env:MY_POD_IP}:8888"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "zipkin": {
                  "title": "The zipkin Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "endpoint"
                  ],
                  "properties": {
                    "endpoint": {
                      "title": "The endpoint Schema",
                      "type": "string",
                      "default": "${env:MY_POD_IP}:9411"
                    }
                  }
                }
              }
            },
            "service": {
              "title": "The service Schema",
              "type": "object",
              "default": {},
              "required": [
                "telemetry",
                "extensions",
                "pipelines"
              ],
              "properties": {
                "telemetry": {
                  "title": "The telemetry Schema",
                  "type": "object",
                  "default": {},
                  "required": [
                    "metrics"
                  ],
                  "properties": {
                    "metrics": {
                      "title": "The metrics Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "address"
                      ],
                      "properties": {
                        "address": {
                          "title": "The address Schema",
                          "type": "string",
                          "default": "${env:MY_POD_IP}:8888"
                        }
                      }
                    }
                  }
                },
                "extensions": {
                  "title": "The extensions Schema",
                  "type": "array",
                  "default": [
                    "health_check",
                    "memory_ballast"
                  ],
                  "items": {
                    "title": "A Schema",
                    "type": "string",
                    "examples": [
                      "health_check",
                      "memory_ballast"
                    ]
                  }
                },
                "pipelines": {
                  "title": "The pipelines Schema",
                  "type": "object",
                  "default": {},
                  "render": "textArea",
                  "required": [
                    "logs",
                    "metrics",
                    "traces"
                  ],
                  "properties": {
                    "logs": {
                      "title": "The logs Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "exporters",
                        "processors",
                        "receivers"
                      ],
                      "properties": {
                        "exporters": {
                          "title": "The exporters Schema",
                          "type": "array",
                          "default": [],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "default": "debug"
                          }
                        },
                        "processors": {
                          "title": "The processors Schema",
                          "type": "array",
                          "default": [
                            "memory_limiter",
                            "batch"
                          ],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "examples": [
                              "memory_limiter",
                              "batch"
                            ]
                          }
                        },
                        "receivers": {
                          "title": "The receivers Schema",
                          "type": "array",
                          "default": [],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "default": "otlp"
                          }
                        }
                      }
                    },
                    "metrics": {
                      "title": "The metrics Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "exporters",
                        "processors",
                        "receivers"
                      ],
                      "properties": {
                        "exporters": {
                          "title": "The exporters Schema",
                          "type": "array",
                          "default": [],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "default": "debug"
                          }
                        },
                        "processors": {
                          "title": "The processors Schema",
                          "type": "array",
                          "default": [
                            "memory_limiter",
                            "batch"
                          ],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "examples": [
                              "memory_limiter",
                              "batch"
                            ]
                          }
                        },
                        "receivers": {
                          "title": "The receivers Schema",
                          "type": "array",
                          "default": [
                            "otlp",
                            "prometheus"
                          ],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "examples": [
                              "otlp",
                              "prometheus"
                            ]
                          }
                        }
                      }
                    },
                    "traces": {
                      "title": "The traces Schema",
                      "type": "object",
                      "default": {},
                      "required": [
                        "exporters",
                        "processors",
                        "receivers"
                      ],
                      "properties": {
                        "exporters": {
                          "title": "The exporters Schema",
                          "type": "array",
                          "default": [],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "default": "debug"
                          }
                        },
                        "processors": {
                          "title": "The processors Schema",
                          "type": "array",
                          "default": [
                            "memory_limiter",
                            "batch"
                          ],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "examples": [
                              "memory_limiter",
                              "batch"
                            ]
                          }
                        },
                        "receivers": {
                          "title": "The receivers Schema",
                          "type": "array",
                          "default": [
                            "otlp",
                            "jaeger",
                            "zipkin"
                          ],
                          "items": {
                            "title": "A Schema",
                            "type": "string",
                            "examples": [
                              "otlp",
                              "jaeger",
                              "zipkin"
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "security": {
      "description": "security specific configuration",
      "type": "object",
      "properties": {
        "password": {
          "type": "string",
          "description": "Password",
          "default": "changeme",
          "render": "password",
          "x-onyxia": {
            "overwriteDefaultWith": "{{service.oneTimePassword}}"
          }
        },
        "allowlist": {
          "type": "object",
          "description": "IP protection",
          "properties": {
            "enabled": {
              "type": "boolean",
              "title": "Enable IP protection",
              "description": "Only the configured set of IPs will be able to reach the service",
              "default": true,
              "x-onyxia": {
                "overwriteDefaultWith": "region.defaultIpProtection"
              }
            },
            "ip": {
              "type": "string",
              "description": "the white list of IP is whitespace",
              "title": "Whitelist of IP",
              "x-onyxia": {
                "overwriteDefaultWith": "{{user.ip}}"
              }
            }
          }
        },
        "networkPolicy": {
          "type": "object",
          "description": "Define access policy to the service",
          "properties": {
            "enabled": {
              "type": "boolean",
              "title": "Enable network policy",
              "description": "Only pod from the same namespace will be allowed",
              "default": true,
              "x-onyxia": {
                "overwriteDefaultWith": "region.defaultNetworkPolicy"
              }
            },
            "from": {
              "type": "array",
              "description": "Array of source allowed to have network access to your service",
              "default": [],
              "x-onyxia": {
                "hidden": true,
                "overwriteDefaultWith": "region.from"
              }
            }
          }
        }
      }
    },
    "networking": {
      "type": "object",
      "form": true,
      "title": "Networking detail",
      "properties": {
        "user": {
          "type": "object",
          "description": "user defined port",
          "properties": {
            "enabled": {
              "type": "boolean",
              "title": "Enable a custom service port",
              "description": "Enable a custom service port",
              "default": false
            },
            "port": {
              "type": "integer",
              "description": "port of the custom service",
              "title": "Custom service port",
              "hidden": {
                "value": false,
                "path": "networking/user/enabled"
              },
              "default": 5000
            }
          }
        }
      }
    },
    "ingress": {
      "type": "object",
      "form": true,
      "title": "Ingress Details",
      "properties": {
        "enabled": {
          "description": "Enable Ingress",
          "type": "boolean",
          "default": true,
          "x-onyxia": {
            "hidden": false,
            "overwriteDefaultWith": "k8s.ingress"
          }
        },
        "hostname": {
          "type": "string",
          "form": true,
          "title": "Hostname",
          "x-form": {
            "value": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
          },
          "x-onyxia": {
            "hidden": false,
            "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
          }
        },
        "ingressClassName": {
          "type": "string",
          "form": true,
          "title": "ingressClassName",
          "default": "",
          "x-form": {
            "hidden": false,
            "value": "{{k8s.ingressClassName}}"
          },
          "x-onyxia": {
            "hidden": false,
            "overwriteDefaultWith": "{{k8s.ingressClassName}}"
          }
        }
      }
    },
    "route": {
      "type": "object",
      "form": true,
      "title": "Route details",
      "properties": {
        "enabled": {
          "description": "Enable route",
          "type": "boolean",
          "default": false,
          "x-onyxia": {
            "hidden": true,
            "overwriteDefaultWith": "k8s.route"
          }
        },
        "hostname": {
          "type": "string",
          "form": true,
          "title": "Hostname",
          "x-onyxia": {
            "hidden": true,
            "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}-0.{{k8s.domain}}"
          }
        },
        "userHostname": {
          "type": "string",
          "form": true,
          "title": "Hostname",
          "x-onyxia": {
            "hidden": true,
            "overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}-user.{{k8s.domain}}"
          }
        }
      }
    },
    "userPreferences": {
      "description": "User Preferences",
      "type": "object",
      "properties": {
        "darkMode": {
          "type": "boolean",
          "description": "dark mode is or is not enabled",
          "default": false,
          "x-onyxia": {
            "hidden": true,
            "overwriteDefaultWith": "user.darkMode"
          }
        },
        "language": {
          "type": "string",
          "description": "Preferred language",
          "default": "en",
          "x-onyxia": {
            "hidden": true,
            "overwriteDefaultWith": "user.lang"
          }
        }
      }
    }
  },
  "required": [
    "opentelemetry-collector",
    "security",
    "networking",
    "ingress",
    "route",
    "userPreferences"
  ]
}